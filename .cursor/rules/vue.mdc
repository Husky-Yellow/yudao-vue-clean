---
description: Vue 3 ä¼ä¸šçº§ç»„ä»¶å¼€å‘æŒ‡å—
glob: "**/*.vue"
alwaysApply: true
---

# ğŸš€ Vue 3 ä¼ä¸šçº§ç»„ä»¶å¼€å‘æŒ‡å—

## ğŸ¯ Vue 3 ç°ä»£åŒ–å¼€å‘åŸåˆ™

### ğŸ“‹ æ ¸å¿ƒæŠ€æœ¯è¦æ±‚
- **ğŸ¨ `<script setup>` è¯­æ³•ç³–** - æ‰€æœ‰ç»„ä»¶å¿…é¡»ä½¿ç”¨ç°ä»£åŒ–è¯­æ³•
- **âš¡ Composition API ä¼˜å…ˆ** - å“åº”å¼æ•°æ®ç®¡ç† + ä¸šåŠ¡é€»è¾‘å°è£…
- **ğŸ”§ TypeScript ä¸¥æ ¼æ¨¡å¼** - `defineProps<T>()` + `defineEmits<T>()`
- **ğŸ›ï¸ Element Plus æ·±åº¦é›†æˆ** - ä¼ä¸šçº§ UI ç»„ä»¶åº“æœ€ä½³å®è·µ
- **ğŸ” UnoCSS åŸå­åŒ–æ ·å¼** - é«˜æ€§èƒ½ CSS å¼•æ“ + å“åº”å¼è®¾è®¡
- **ğŸ” RBAC æƒé™ç³»ç»Ÿ** - ç»†ç²’åº¦æƒé™æ§åˆ¶ + æŒ‡ä»¤å¼æƒé™æ£€æŸ¥

### ğŸ—ï¸ ä¼ä¸šçº§æ¶æ„æ¨¡å¼
- **ğŸ“¦ ä¸šåŠ¡åŸŸç»„ä»¶è®¾è®¡** - è®¾å¤‡ç®¡ç†ã€å·¥ä½œæµå¼•æ“ã€ç³»ç»Ÿç®¡ç†
- **ğŸ”„ Composables ä¸šåŠ¡é€»è¾‘å¤ç”¨** - `useTable`ã€`useForm`ã€`useCrudSchemas`
- **ğŸ­ ç»„ä»¶åˆ†å±‚æ¶æ„** - é¡µé¢ç»„ä»¶ â†’ ä¸šåŠ¡ç»„ä»¶ â†’ åŸºç¡€ç»„ä»¶
- **ğŸ›¡ï¸ é”™è¯¯è¾¹ç•Œä¸åŠ è½½çŠ¶æ€** - ç»Ÿä¸€é”™è¯¯å¤„ç† + ä¼˜é›…çš„ç”¨æˆ·åé¦ˆ
- **âš¡ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥** - æ‡’åŠ è½½ã€è™šæ‹Ÿæ»šåŠ¨ã€å†…å­˜ç®¡ç†

## ğŸ—ï¸ ä¼ä¸šçº§ç»„ä»¶æ¶æ„è®¾è®¡

### ğŸ¨ ç»„ä»¶åˆ†å±‚æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ–¥ï¸  Page Components (é¡µé¢ç»„ä»¶)                           â”‚
â”‚  â”œâ”€â”€ DeviceManagement.vue    # è®¾å¤‡ç®¡ç†ä¸»é¡µ               â”‚
â”‚  â”œâ”€â”€ ProcessDesigner.vue     # æµç¨‹è®¾è®¡å™¨é¡µé¢             â”‚
â”‚  â””â”€â”€ UserSettings.vue        # ç”¨æˆ·è®¾ç½®é¡µé¢               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ§©  Business Components (ä¸šåŠ¡ç»„ä»¶)                      â”‚
â”‚  â”œâ”€â”€ DeviceTable.vue         # è®¾å¤‡æ•°æ®è¡¨æ ¼               â”‚
â”‚  â”œâ”€â”€ ProcessForm.vue         # æµç¨‹è¡¨å•ç»„ä»¶               â”‚
â”‚  â””â”€â”€ PermissionTree.vue      # æƒé™æ ‘ç»„ä»¶                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ”§  Base Components (åŸºç¡€ç»„ä»¶)                          â”‚
â”‚  â”œâ”€â”€ SmartSearch.vue         # æ™ºèƒ½æœç´¢ç»„ä»¶               â”‚
â”‚  â”œâ”€â”€ DataTable.vue           # é€šç”¨æ•°æ®è¡¨æ ¼               â”‚
â”‚  â””â”€â”€ FormBuilder.vue         # åŠ¨æ€è¡¨å•æ„å»ºå™¨             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸš€ ç°ä»£åŒ–é¡µé¢ç»„ä»¶æ¨¡æ¿
```vue
<template>
  <div class="enterprise-layout">
    <!-- ğŸ·ï¸ é¡µé¢å¤´éƒ¨å¯¼èˆª -->
    <PageHeader 
      :breadcrumb="breadcrumbConfig"
      :title="pageConfig.title"
      :subtitle="pageConfig.subtitle"
    >
      <template #extra>
        <!-- ğŸ” æƒé™æ§åˆ¶çš„æ“ä½œæŒ‰é’® -->
        <el-space>
          <el-button
            v-hasPermi="['device:export']"
            type="primary"
            :loading="exportLoading"
            @click="handleBatchExport"
          >
            <Icon icon="ep:download" />
            æ‰¹é‡å¯¼å‡º
          </el-button>
          
          <el-button
            v-hasPermi="['device:create']"
            type="primary"
            @click="handleCreate"
          >
            <Icon icon="ep:plus" />
            æ–°å¢è®¾å¤‡
          </el-button>
        </el-space>
      </template>
    </PageHeader>

    <!-- ğŸ“Š æ•°æ®æ¦‚è§ˆå¡ç‰‡ -->
    <div class="overview-cards mb-20px">
      <el-row :gutter="16">
        <el-col 
          v-for="stat in deviceStats" 
          :key="stat.key"
          :span="6"
        >
          <StatCard
            :title="stat.title"
            :value="stat.value"
            :trend="stat.trend"
            :color="stat.color"
            :icon="stat.icon"
            @click="handleStatFilter(stat.key)"
          />
        </el-col>
      </el-row>
    </div>

    <!-- ğŸ¯ ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <ContentWrap>
      <!-- ğŸ” æ™ºèƒ½æœç´¢ä¸ç­›é€‰ -->
      <SmartSearch
        v-model="searchFormData"
        :schema="searchSchema"
        :loading="searchLoading"
        @search="handleAdvancedSearch"
        @reset="handleSearchReset"
        @export="handleSearchExport"
      />

      <!-- ğŸ“‹ æ‰¹é‡æ“ä½œå·¥å…·æ  -->
      <div 
        v-show="hasSelectedRows"
        class="batch-actions-bar"
      >
        <el-alert
          :title="`å·²é€‰æ‹© ${selectedRows.length} é¡¹`"
          type="info"
          show-icon
          :closable="false"
        >
          <template #default>
            <el-space>
              <el-button
                size="small"
                @click="handleBatchEdit"
              >
                æ‰¹é‡ç¼–è¾‘
              </el-button>
              <el-button
                size="small"
                type="danger"
                @click="handleBatchDelete"
              >
                æ‰¹é‡åˆ é™¤
              </el-button>
            </el-space>
          </template>
        </el-alert>
      </div>

      <!-- ğŸ“Š é«˜æ€§èƒ½æ•°æ®è¡¨æ ¼ -->
      <EnterpriseTable
        ref="tableRef"
        v-model:selection="selectedRows"
        :data="tableData"
        :columns="tableColumns"
        :loading="tableLoading"
        :pagination="paginationConfig"
        :row-key="'id'"
        :default-sort="{ prop: 'createTime', order: 'descending' }"
        @refresh="refreshTableData"
        @sort-change="handleSortChange"
        @filter-change="handleFilterChange"
        @row-click="handleRowClick"
        @row-dblclick="handleRowDoubleClick"
      >
        <!-- ğŸ·ï¸ è®¾å¤‡çŠ¶æ€åˆ— -->
        <template #deviceStatus="{ row }">
          <DeviceStatusBadge
            :status="row.deviceStatus"
            :last-online="row.lastOnlineTime"
            :show-tooltip="true"
          />
        </template>

        <!-- ğŸ—ºï¸ ä½ç½®ä¿¡æ¯åˆ— -->
        <template #location="{ row }">
          <LocationDisplay
            :latitude="row.latitude"
            :longitude="row.longitude"
            :address="row.address"
            @view-map="handleViewLocation(row)"
          />
        </template>

        <!-- âš™ï¸ æ“ä½œåˆ— -->
        <template #actions="{ row }">
          <ActionDropdown
            :actions="getRowActions(row)"
            @action="handleRowAction"
          />
        </template>
      </EnterpriseTable>
    </ContentWrap>

    <!-- ğŸ“ ä¸šåŠ¡è¡¨å•å¯¹è¯æ¡† -->
    <DeviceFormDialog
      v-model="formDialog.visible"
      :device-data="formDialog.data"
      :form-mode="formDialog.mode"
      :form-schema="deviceFormSchema"
      @success="handleFormSuccess"
      @cancel="handleFormCancel"
    />

    <!-- ğŸ—ºï¸ è®¾å¤‡ä½ç½®æŸ¥çœ‹å™¨ -->
    <LocationViewerDialog
      v-model="locationDialog.visible"
      :device="locationDialog.device"
      :readonly="true"
    />
  </div>
</template>

<script setup lang="ts">
// ğŸ¯ æ ¸å¿ƒ Composition API å¯¼å…¥
import { ref, reactive, computed, onMounted, onUnmounted } from 'vue'
import { useRouter, useRoute } from 'vue-router'

// ğŸ”§ ä¸šåŠ¡ Hooks å¯¼å…¥
import { useDeviceManagement } from '@/hooks/business/useDeviceManagement'
import { usePermission } from '@/hooks/system/usePermission'
import { useExport } from '@/hooks/common/useExport'
import { useWebSocket } from '@/hooks/common/useWebSocket'

// ğŸ“‹ ç±»å‹å®šä¹‰å¯¼å…¥
import type { 
  DeviceVO, 
  DeviceSearchParams,
  DeviceStatistics,
  DeviceFormData 
} from '@/api/EquipmentManagement/types'

import type { 
  TableColumnConfig,
  PaginationConfig,
  FormDialogState 
} from '@/types/common'

// ğŸ·ï¸ ç»„ä»¶é€‰é¡¹å®šä¹‰
defineOptions({
  name: 'DeviceManagement',
  inheritAttrs: false
})

// ğŸ¯ è·¯ç”±ä¸æƒé™
const router = useRouter()
const route = useRoute()
const { hasPermission, hasRole } = usePermission()

// ğŸ“Š ä¸šåŠ¡æ•°æ®ç®¡ç†
const {
  // ğŸ—‚ï¸ è¡¨æ ¼æ•°æ®çŠ¶æ€
  tableData,
  tableLoading,
  selectedRows,
  paginationConfig,
  
  // ğŸ“ˆ ç»Ÿè®¡æ•°æ®
  deviceStats,
  
  // ğŸ” æœç´¢é…ç½®
  searchFormData,
  searchSchema,
  searchLoading,
  
  // ğŸ“‹ è¡¨æ ¼é…ç½®
  tableColumns,
  deviceFormSchema,
  
  // ğŸ”§ ä¸šåŠ¡æ–¹æ³•
  methods: {
    refreshTableData,
    handleAdvancedSearch,
    handleSearchReset,
    getRowActions,
    createDevice,
    updateDevice,
    deleteDevice
  }
} = useDeviceManagement()

// ğŸ”„ å®æ—¶æ•°æ®åŒæ­¥
const { 
  connect: connectWebSocket,
  disconnect: disconnectWebSocket
} = useWebSocket({
  url: '/ws/device-status',
  onMessage: handleDeviceStatusUpdate
})

// ğŸ“Š æ•°æ®å¯¼å‡ºåŠŸèƒ½
const { 
  handleExport: handleBatchExport,
  exportLoading
} = useExport({
  exportApi: exportDeviceListApi,
  filename: 'è®¾å¤‡ç®¡ç†æ•°æ®'
})

// ğŸ¨ UI çŠ¶æ€ç®¡ç†
const formDialog = reactive<FormDialogState<DeviceFormData>>({
  visible: false,
  mode: 'create',
  data: null
})

const locationDialog = reactive({
  visible: false,
  device: null as DeviceVO | null
})

// ğŸ’¡ è®¡ç®—å±æ€§
const hasSelectedRows = computed(() => selectedRows.value.length > 0)

const breadcrumbConfig = computed(() => [
  { label: 'é¦–é¡µ', to: '/' },
  { label: 'è®¾å¤‡ç®¡ç†', to: '/equipment' },
  { label: 'è®¾å¤‡åˆ—è¡¨' }
])

const pageConfig = computed(() => ({
  title: 'è®¾å¤‡ç®¡ç†',
  subtitle: `å…± ${paginationConfig.total} å°è®¾å¤‡`
}))

// ğŸ¯ ä¸šåŠ¡äº¤äº’å¤„ç†
const handleCreate = () => {
  formDialog.mode = 'create'
  formDialog.data = null
  formDialog.visible = true
}

const handleRowClick = (row: DeviceVO) => {
  // å•å‡»æŸ¥çœ‹è¯¦æƒ…
  router.push(`/equipment/device/${row.id}`)
}

const handleRowDoubleClick = (row: DeviceVO) => {
  // åŒå‡»ç¼–è¾‘
  if (hasPermission('device:edit')) {
    formDialog.mode = 'edit'
    formDialog.data = { ...row }
    formDialog.visible = true
  }
}

const handleRowAction = (action: string, row: DeviceVO) => {
  switch (action) {
    case 'edit':
      handleEdit(row)
      break
    case 'delete':
      handleDelete(row)
      break
    case 'control':
      handleDeviceControl(row)
      break
    case 'view-location':
      handleViewLocation(row)
      break
  }
}

const handleDeviceStatusUpdate = (message: any) => {
  // å®æ—¶æ›´æ–°è®¾å¤‡çŠ¶æ€
  const { deviceId, status, lastOnlineTime } = message
  const device = tableData.value.find(d => d.id === deviceId)
  if (device) {
    device.deviceStatus = status
    device.lastOnlineTime = lastOnlineTime
  }
}

// ğŸ”„ ç”Ÿå‘½å‘¨æœŸç®¡ç†
onMounted(() => {
  refreshTableData()
  connectWebSocket()
})

onUnmounted(() => {
  disconnectWebSocket()
})
</script>

<style scoped lang="scss">
.enterprise-layout {
  @apply flex flex-col h-full bg-gray-50;
  
  .overview-cards {
    @apply px-20px;
  }
  
  .batch-actions-bar {
    @apply mb-16px;
  }
}
</style>
```

## ğŸ”„ å“åº”å¼æ•°æ®ç®¡ç†

```typescript
// âœ… åŸºæœ¬æ•°æ®ç±»å‹ä½¿ç”¨ ref
const loading = ref(false)
const deviceCount = ref(0)
const selectedDevice = ref<DeviceVO | null>(null)

// âœ… å¯¹è±¡æ•°æ®ä½¿ç”¨ reactive  
const formData = reactive({
  deviceName: '',
  deviceType: '',
  location: ''
})

// âœ… è®¡ç®—å±æ€§ç”¨äºæ´¾ç”ŸçŠ¶æ€
const deviceStatusText = computed(() => {
  return DICT_TYPE.DEVICE_STATUS.find(item => 
    item.value === formData.deviceStatus
  )?.label || 'æœªçŸ¥'
})

// âœ… ç›‘å¬å™¨å¤„ç†å‰¯ä½œç”¨
watch(() => formData.deviceType, (newType) => {
  // è®¾å¤‡ç±»å‹å˜æ›´æ—¶é‡ç½®ç›¸å…³å­—æ®µ
  formData.location = ''
  fetchLocationsByType(newType)
}, { immediate: true })
```

## ğŸ¯ ä¸šåŠ¡ç»„ä»¶å¼€å‘æ¨¡å¼

### 1. è¡¨æ ¼é¡µé¢ç»„ä»¶
```typescript
// ä½¿ç”¨ useTable hook ç®¡ç†è¡¨æ ¼çŠ¶æ€
const { tableObject, methods } = useTable({
  getListApi: getDeviceListApi,
  deleteApi: deleteDeviceApi,
  exportApi: exportDeviceApi
})

// è§£æ„å¸¸ç”¨æ–¹æ³•
const { getList, delList, exportList } = methods
```

### 2. è¡¨å•é¡µé¢ç»„ä»¶
```typescript
// ä½¿ç”¨ useForm hook ç®¡ç†è¡¨å•
const { formRef, rules, formMethods } = useForm()
const { validate, resetFields } = formMethods

// è¡¨å•æäº¤å¤„ç†
const handleSubmit = async () => {
  const valid = await validate()
  if (!valid) return
  
  try {
    loading.value = true
    await createDeviceApi(formData)
    ElMessage.success('åˆ›å»ºæˆåŠŸ')
    back()
  } catch (error) {
    ElMessage.error('åˆ›å»ºå¤±è´¥')
  } finally {
    loading.value = false
  }
}
```

### 3. å¯¹è¯æ¡†ç»„ä»¶
```typescript
// å¯¹è¯æ¡†æ˜¾ç¤ºæ§åˆ¶
const dialogVisible = ref(false)
const dialogTitle = ref('æ·»åŠ è®¾å¤‡')

// æ‰“å¼€å¯¹è¯æ¡†
const openDialog = (type: 'create' | 'edit', row?: DeviceVO) => {
  dialogTitle.value = type === 'create' ? 'æ·»åŠ è®¾å¤‡' : 'ç¼–è¾‘è®¾å¤‡'
  if (type === 'edit' && row) {
    Object.assign(formData, row)
  } else {
    resetFields()
  }
  dialogVisible.value = true
}

// å…³é—­å¯¹è¯æ¡†
const closeDialog = () => {
  dialogVisible.value = false
  resetFields()
}
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–æŠ€å·§

### 1. ç»„ä»¶æ‡’åŠ è½½
```typescript
// ä½¿ç”¨ defineAsyncComponent è¿›è¡Œç»„ä»¶æ‡’åŠ è½½
const ProcessDesigner = defineAsyncComponent(() => 
  import('@/components/bpmnProcessDesigner')
)
```

### 2. å¤§æ•°æ®åˆ—è¡¨ä¼˜åŒ–
```vue
<template>
  <!-- ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨å¤„ç†å¤§é‡æ•°æ® -->
  <ElVirtualList
    :data="deviceList"
    :item-size="60"
    :height="400"
  >
    <template #default="{ item }">
      <DeviceItem :device="item" />
    </template>
  </ElVirtualList>
</template>
```

### 3. æ¡ä»¶æ¸²æŸ“ä¼˜åŒ–
```vue
<template>
  <!-- ä½¿ç”¨ v-show è€Œä¸æ˜¯ v-if è¿›è¡Œé¢‘ç¹åˆ‡æ¢ -->
  <div v-show="showAdvancedOptions" class="advanced-options">
    <!-- é«˜çº§é€‰é¡¹å†…å®¹ -->
  </div>
  
  <!-- ä½¿ç”¨ v-memo ç¼“å­˜å¤æ‚è®¡ç®—ç»“æœ -->
  <DeviceChart 
    v-memo="[deviceData.length, selectedTimeRange]"
    :data="deviceData"
    :time-range="selectedTimeRange"
  />
</template>
```

## ğŸ¯ æœ€ä½³å®è·µ

### Props å’Œ Emits å®šä¹‰
```typescript
// Props æ¥å£å®šä¹‰
interface Props {
  deviceId?: string
  readonly?: boolean
  showActions?: boolean
}

const props = withDefaults(defineProps<Props>(), {
  readonly: false,
  showActions: true
})

// Emits äº‹ä»¶å®šä¹‰
interface Emits {
  (e: 'update', device: DeviceVO): void
  (e: 'delete', deviceId: string): void
}

const emit = defineEmits<Emits>()
```

### æƒé™æ§åˆ¶é›†æˆ
```vue
<template>
  <!-- æŒ‰é’®æƒé™æ§åˆ¶ -->
  <el-button 
    v-hasPermi="['device:create']"
    type="primary"
    @click="handleCreate"
  >
    æ–°å¢è®¾å¤‡
  </el-button>
  
  <!-- è§’è‰²æƒé™æ§åˆ¶ -->
  <div v-hasRole="['admin', 'operator']">
    ç®¡ç†å‘˜æ“ä½œåŒºåŸŸ
  </div>
</template>
```

### é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ
```typescript
// ç»Ÿä¸€é”™è¯¯å¤„ç†
const handleApiCall = async (apiCall: Promise<any>, successMessage = 'æ“ä½œæˆåŠŸ') => {
  try {
    loading.value = true
    const result = await apiCall
    ElMessage.success(successMessage)
    return result
  } catch (error) {
    console.error('APIè°ƒç”¨å¤±è´¥:', error)
    ElMessage.error('æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•')
    throw error
  } finally {
    loading.value = false
  }
}
```

